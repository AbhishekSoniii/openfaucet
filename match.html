<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenFlow flow matching &mdash; OpenFaucet v1.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="OpenFaucet v1.1 documentation" href="index.html" />
    <link rel="next" title="OpenFlow switch configuration" href="config.html" />
    <link rel="prev" title="OpenFlow controller developer’s guide" href="controller.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="config.html" title="OpenFlow switch configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="controller.html" title="OpenFlow controller developer’s guide"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenFaucet v1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="openflow-flow-matching">
<h1>OpenFlow flow matching<a class="headerlink" href="#openflow-flow-matching" title="Permalink to this headline">¶</a></h1>
<p>Each datapath flow entry is primarily defined by a
<a title="openfaucet.ofmatch.Match" class="reference internal" href="#openfaucet.ofmatch.Match"><tt class="xref docutils literal"><span class="pre">Match</span></tt></a> object which specifies which
packets are part of the flow, as a set of packet fields to match and
their expected values. The OpenFlow standard specifies the set of
packet fields that can be matched, at Layer-2 (Ethernet), Layer-3 (IP,
ARP), and Layer-4 (ICMP, TCP, UDP).</p>
<p><a title="openfaucet.ofmatch.Match" class="reference internal" href="#openfaucet.ofmatch.Match"><tt class="xref docutils literal"><span class="pre">Match</span></tt></a> is a named tuple class
(cf. Python&#8217;s <tt class="xref docutils literal"><span class="pre">collections</span></tt>), i.e. matches are also tuples whose
elements each correspond to an attribute. To create a match, its
attributes can be given in positional order, or using keywords, i.e.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="p">(</span>
    <span class="n">in_port</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">dl_src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dl_dst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dl_vlan</span><span class="o">=</span><span class="mi">11423</span><span class="p">,</span> <span class="n">dl_vlan_pcp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">dl_type</span><span class="o">=</span><span class="mh">0x800</span><span class="p">,</span> <span class="n">nw_tos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nw_proto</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nw_src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nw_dst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">tp_src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tp_dst</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">11423</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mh">0x800</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                      <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Likewise, attributes can be accessed by position or by name, i.e.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dl_src</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dl_src</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">dl_src</span>
</pre></div>
</div>
<p>Attribute access by name is recommended for readability. Every match,
just like any tuple, is immutable and hashable. A copy of an existing
match with some of its attributes modified can be created by calling
<tt class="xref docutils literal"><span class="pre">_replace()</span></tt>, for instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">new_match</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tp_dst</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>Any attribute can be wildcarded, to ignore that field in matching
packets. For instance, if all attributes are wildcarded, all packets
match the flow. All attributes can be wildcarded by setting their
value to <tt class="xref docutils literal"><span class="pre">None</span></tt>. In addition,
<a title="openfaucet.ofmatch.Match.nw_src" class="reference internal" href="#openfaucet.ofmatch.Match.nw_src"><tt class="xref docutils literal"><span class="pre">nw_src</span></tt></a> and
<a title="openfaucet.ofmatch.Match.nw_dst" class="reference internal" href="#openfaucet.ofmatch.Match.nw_dst"><tt class="xref docutils literal"><span class="pre">nw_dst</span></tt></a> can be partly wildcarded, to
match only prefixes of IPv4 addresses instead of full
addresses. <a title="openfaucet.ofmatch.Match.create_wildcarded" class="reference internal" href="#openfaucet.ofmatch.Match.create_wildcarded"><tt class="xref docutils literal"><span class="pre">create_wildcarded()</span></tt></a> is a
helper method to create wildcarded matches:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">tp_dst</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                      <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="openfaucet.ofmatch.Match">
<em class="property">class </em><tt class="descclassname">openfaucet.ofmatch.</tt><tt class="descname">Match</tt><a class="headerlink" href="#openfaucet.ofmatch.Match" title="Permalink to this definition">¶</a></dt>
<dd><p>Datapath input port:</p>
<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.in_port">
<tt class="descname">in_port</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.in_port" title="Permalink to this definition">¶</a></dt>
<dd><p>The input port, as a 16-bit unsigned integer. E.g. to match all
packets coming into port 12:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>Layer-2 header (Ethernet):</p>
<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.dl_src">
<tt class="descname">dl_src</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.dl_src" title="Permalink to this definition">¶</a></dt>
<dd><p>The MAC source address, as a binary string. E.g. to match all
packets from MAC address <tt class="docutils literal"><span class="pre">02:12:34:56:78:90</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span>
    <span class="n">dl_src</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\x02\x12\x34\x56\x78\x90</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.dl_dst">
<tt class="descname">dl_dst</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.dl_dst" title="Permalink to this definition">¶</a></dt>
<dd><p>The MAC destination address, as a binary string. E.g. to match all
broadcast packets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span>
    <span class="n">dl_src</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\xff\xff\xff\xff\xff\xff</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.dl_vlan">
<tt class="descname">dl_vlan</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.dl_vlan" title="Permalink to this definition">¶</a></dt>
<dd><p>The input VLAN ID, as a 16-bit unsigned integer. E.g. to match all
packets in VLAN with ID 123:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span><span class="n">dl_vlan</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.dl_vlan_pcp">
<tt class="descname">dl_vlan_pcp</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.dl_vlan_pcp" title="Permalink to this definition">¶</a></dt>
<dd>The input VLAN priority, as a 8-bit unsigned integer.</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.dl_type">
<tt class="descname">dl_type</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.dl_type" title="Permalink to this definition">¶</a></dt>
<dd><p>The Ethernet frame type, as a 16-bit unsigned integer. E.g. to
match all IPv6 packets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span><span class="n">dl_type</span><span class="o">=</span><span class="mh">0x86dd</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>Layer-3 header (IPv4 and ARP):</p>
<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.nw_tos">
<tt class="descname">nw_tos</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.nw_tos" title="Permalink to this definition">¶</a></dt>
<dd><p>The IP ToS (only the DSCP field&#8217;s 6 bits), as an 8-bit unsigned
integer. Bits 0 and 1 are reserved and must be set to 0. E.g. to
match all IPv4 packets in the Expedited Forwarding class (DSCP
field value <tt class="docutils literal"><span class="pre">0x2e</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span>
    <span class="n">dl_type</span><span class="o">=</span><span class="mh">0x0800</span><span class="p">,</span> <span class="n">nw_tos</span><span class="o">=</span><span class="p">(</span><span class="mh">0x2e</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.nw_proto">
<tt class="descname">nw_proto</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.nw_proto" title="Permalink to this definition">¶</a></dt>
<dd><p>If the L3 protocol is IPv4, the IP protocol, or if the L3 protocol
is ARP, the lower 8 bits of the ARP opcode, as an 8-bit unsigned
integer. E.g. to match all TCPv4 packets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span>
    <span class="n">dl_type</span><span class="o">=</span><span class="mh">0x0800</span><span class="p">,</span> <span class="n">nw_proto</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.nw_src">
<tt class="descname">nw_src</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.nw_src" title="Permalink to this definition">¶</a></dt>
<dd><p>The IPv4 source address, as a tuple (address, prefix_length),
where address is the address as a binary string, and prefix_length
is the number of bits to match in the address. prefix_length must
be &gt; 0. E.g. to match all IPv4 packets with sources address in
CIDR prefix <tt class="docutils literal"><span class="pre">192.168.1.0/24</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">ip_addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="s">&#39;192.168.1.0&#39;</span><span class="p">)</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span>
    <span class="n">dl_type</span><span class="o">=</span><span class="mh">0x0800</span><span class="p">,</span> <span class="n">nw_src</span><span class="o">=</span><span class="p">(</span><span class="n">ip_addr</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.nw_dst">
<tt class="descname">nw_dst</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.nw_dst" title="Permalink to this definition">¶</a></dt>
<dd>The IPv4 destination address, as a tuple (address, prefix_length),
where address is the address as a binary string, and prefix_length
is the number of bits to match in the address. prefix_length must
be &gt; 0.</dd></dl>

<p>Layer-4 header (TCPv4 and UDPv4):</p>
<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.tp_src">
<tt class="descname">tp_src</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.tp_src" title="Permalink to this definition">¶</a></dt>
<dd>The TCP/UDP source port, as a 16-bit unsigned integer.</dd></dl>

<dl class="attribute">
<dt id="openfaucet.ofmatch.Match.tp_dst">
<tt class="descname">tp_dst</tt><a class="headerlink" href="#openfaucet.ofmatch.Match.tp_dst" title="Permalink to this definition">¶</a></dt>
<dd><p>The TCP/UDP destination port, as a 16-bit unsigned
integer. E.g. to match all TCPv4 packets to port 80 (WWW):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openfaucet</span> <span class="kn">import</span> <span class="n">ofmatch</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">ofmatch</span><span class="o">.</span><span class="n">Match</span><span class="o">.</span><span class="n">create_wildcarded</span><span class="p">(</span>
    <span class="n">dl_type</span><span class="o">=</span><span class="mh">0x0800</span><span class="p">,</span> <span class="n">nw_proto</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">tp_dst</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>Utility methods:</p>
<dl class="classmethod">
<dt id="openfaucet.ofmatch.Match.create_wildcarded">
<em class="property">classmethod </em><tt class="descname">create_wildcarded</tt><big>(</big><span class="optional">[</span><em>in_port=None</em>, <em>dl_src=None</em>, <em>dl_dst=None</em>, <em>dl_vlan=None</em>, <em>dl_vlan_pcp=None</em>, <em>dl_type=None</em>, <em>nw_tos=None</em>, <em>nw_proto=None</em>, <em>nw_src=None</em>, <em>nw_dst=None</em>, <em>tp_src=None</em>, <em>tp_dst=None</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#openfaucet.ofmatch.Match.create_wildcarded" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new <a title="openfaucet.ofmatch.Match" class="reference internal" href="#openfaucet.ofmatch.Match"><tt class="xref docutils literal"><span class="pre">Match</span></tt></a> with flow attributes wildcarded unless
specified.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Returns:</th><td class="field-body">A new <a title="openfaucet.ofmatch.Match" class="reference internal" href="#openfaucet.ofmatch.Match"><tt class="xref docutils literal"><span class="pre">Match</span></tt></a> object whose attributes are set to
the given values, or <tt class="xref docutils literal"><span class="pre">None</span></tt> (i.e. wildcarded) if not
specified.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h4>Previous topic</h4>
            <p class="topless"><a href="controller.html"
                                  title="previous chapter">OpenFlow controller developer&#8217;s guide</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="config.html"
                                  title="next chapter">OpenFlow switch configuration</a></p>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="config.html" title="OpenFlow switch configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="controller.html" title="OpenFlow controller developer’s guide"
             >previous</a> |</li>
        <li><a href="index.html">OpenFaucet v1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2011, Midokura KK.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>